# ğŸ—ï¸ System Architecture Diagram

## Complete System Overview

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ONEBOX EMAIL AGGREGATOR                              â•‘
â•‘                    3-Tier Architecture for Email Search                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PRESENTATION LAYER                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Streamlit Web UI                              â”‚    â”‚
â”‚  â”‚                      Port: 8501                                    â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Features:                                                         â”‚    â”‚
â”‚  â”‚  â€¢ Natural language search interface                              â”‚    â”‚
â”‚  â”‚  â€¢ Category filtering (Important, Marketing, etc.)                â”‚    â”‚
â”‚  â”‚  â€¢ Dual search modes (API Mode / Direct Mode)                     â”‚    â”‚
â”‚  â”‚  â€¢ Expandable email preview cards                                 â”‚    â”‚
â”‚  â”‚  â€¢ Real-time result display                                       â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Access: http://localhost:8501                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTP REST API Calls
                                 â”‚ (JSON Request/Response)
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            APPLICATION LAYER                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      API Server                                    â”‚    â”‚
â”‚  â”‚                      Port: 3000                                    â”‚    â”‚
â”‚  â”‚                      (FastAPI)                                     â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Endpoints:                                                        â”‚    â”‚
â”‚  â”‚  GET  /                    â†’ Welcome message                      â”‚    â”‚
â”‚  â”‚  GET  /health              â†’ Service status check                 â”‚    â”‚
â”‚  â”‚  GET  /api/emails/search   â†’ Search emails                        â”‚    â”‚
â”‚  â”‚       ?q=query             â†’ Query parameter                      â”‚    â”‚
â”‚  â”‚       &type=hybrid         â†’ Search type (hybrid/vector/keyword)  â”‚    â”‚
â”‚  â”‚  GET  /api/emails/{id}     â†’ Get specific email                   â”‚    â”‚
â”‚  â”‚  POST /api/emails/classify â†’ Classify email                       â”‚    â”‚
â”‚  â”‚  GET  /api/stats           â†’ System statistics                    â”‚    â”‚
â”‚  â”‚  GET  /docs                â†’ Swagger documentation                â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Features:                                                         â”‚    â”‚
â”‚  â”‚  â€¢ Request validation (Pydantic models)                           â”‚    â”‚
â”‚  â”‚  â€¢ Error handling & logging                                       â”‚    â”‚
â”‚  â”‚  â€¢ CORS middleware                                                â”‚    â”‚
â”‚  â”‚  â€¢ Auto-generated OpenAPI docs                                    â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Access: http://localhost:3000                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Search Orchestration
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BUSINESS LOGIC LAYER                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   Hybrid Search Service                            â”‚    â”‚
â”‚  â”‚                   (search_service.py)                              â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Algorithm:                                                        â”‚    â”‚
â”‚  â”‚  1. Query both VectorDB (semantic) and Elasticsearch (keyword)    â”‚    â”‚
â”‚  â”‚  2. Normalize scores from both sources (0-1 range)                â”‚    â”‚
â”‚  â”‚  3. Apply weighted combination:                                   â”‚    â”‚
â”‚  â”‚     â€¢ 70% weight for semantic relevance                           â”‚    â”‚
â”‚  â”‚     â€¢ 30% weight for keyword matching                             â”‚    â”‚
â”‚  â”‚  4. Merge and deduplicate results                                 â”‚    â”‚
â”‚  â”‚  5. Sort by combined relevance score                              â”‚    â”‚
â”‚  â”‚  6. Return top N results                                          â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  Fallback: If Elasticsearch unavailable â†’ VectorDB only (100%)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                        â”‚
                  â”‚ Semantic Search                        â”‚ Keyword Search
                  â”‚ (Natural Language)                     â”‚ (Exact Matching)
                  â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        DATA LAYER - SEMANTIC         â”‚    â”‚       DATA LAYER - KEYWORD       â”‚
â”‚                                      â”‚    â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   VectorDB Service             â”‚  â”‚    â”‚  â”‚   Elasticsearch            â”‚ â”‚
â”‚  â”‚   Port: 8001                   â”‚  â”‚    â”‚  â”‚   (Optional)               â”‚ â”‚
â”‚  â”‚   (FastAPI)                    â”‚  â”‚    â”‚  â”‚                            â”‚ â”‚
â”‚  â”‚                                â”‚  â”‚    â”‚  â”‚  Full-text search engine   â”‚ â”‚
â”‚  â”‚  Technology Stack:             â”‚  â”‚    â”‚  â”‚  â€¢ Inverted index          â”‚ â”‚
â”‚  â”‚  â€¢ ChromaDB (Vector Store)     â”‚  â”‚    â”‚  â”‚  â€¢ Fast keyword matching   â”‚ â”‚
â”‚  â”‚  â€¢ SentenceTransformers        â”‚  â”‚    â”‚  â”‚  â€¢ Boolean queries         â”‚ â”‚
â”‚  â”‚  â€¢ all-MiniLM-L6-v2 model      â”‚  â”‚    â”‚  â”‚  â€¢ Field-specific search   â”‚ â”‚
â”‚  â”‚  â€¢ PyTorch 2.6.0+cpu           â”‚  â”‚    â”‚  â”‚                            â”‚ â”‚
â”‚  â”‚                                â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  Capabilities:                 â”‚  â”‚    â”‚                                  â”‚
â”‚  â”‚  â€¢ Semantic similarity search  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚  â€¢ Context-aware queries       â”‚  â”‚
â”‚  â”‚  â€¢ Email embeddings (384-dim)  â”‚  â”‚
â”‚  â”‚  â€¢ Persistent storage          â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚  Endpoints:                    â”‚  â”‚
â”‚  â”‚  GET  /health                  â”‚  â”‚
â”‚  â”‚  GET  /search?q=query          â”‚  â”‚
â”‚  â”‚  POST /add_email               â”‚  â”‚
â”‚  â”‚  POST /add_emails_batch        â”‚  â”‚
â”‚  â”‚  GET  /stats                   â”‚  â”‚
â”‚  â”‚  GET  /docs                    â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚  Storage:                      â”‚  â”‚
â”‚  â”‚  ./vector_store/               â”‚  â”‚
â”‚  â”‚  â€¢ ChromaDB SQLite database    â”‚  â”‚
â”‚  â”‚  â€¢ Embedding vectors           â”‚  â”‚
â”‚  â”‚  â€¢ Email metadata              â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚  Access: localhost:8001        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                           CPU OPTIMIZATION STACK

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     NO GPU REQUIRED - 100% CPU OPTIMIZED                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Machine Learning Stack:                                                     â”‚
â”‚                                                                              â”‚
â”‚  PyTorch 2.6.0+cpu                                                          â”‚
â”‚  â”œâ”€ Installed from: https://download.pytorch.org/whl/cpu                   â”‚
â”‚  â”œâ”€ No CUDA dependencies                                                    â”‚
â”‚  â””â”€ Windows/Linux/macOS compatible                                          â”‚
â”‚                                                                              â”‚
â”‚  SentenceTransformers                                                        â”‚
â”‚  â”œâ”€ Model: all-MiniLM-L6-v2                                                 â”‚
â”‚  â”œâ”€ Embedding dimension: 384                                                â”‚
â”‚  â”œâ”€ Device: CPU (explicitly set)                                            â”‚
â”‚  â””â”€ Inference speed: ~100-200 emails/sec                                    â”‚
â”‚                                                                              â”‚
â”‚  Environment Variables:                                                      â”‚
â”‚  â”œâ”€ CUDA_VISIBLE_DEVICES=-1    (Disables GPU detection)                    â”‚
â”‚  â”œâ”€ FORCE_CPU=1                (Forces CPU mode)                            â”‚
â”‚  â””â”€ Set at script startup before imports                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                              DATA FLOW DIAGRAM

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚   Browser   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Search Query: "emails about invoices"
       â”‚    GET request to Streamlit UI (8501)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit UI    â”‚
â”‚  (Port 8501)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. API Call: GET /api/emails/search?q=emails about invoices&type=hybrid
       â”‚    HTTP request to API Server
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Server     â”‚
â”‚   (Port 3000)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Invoke HybridSearch.search_detailed()
       â”‚    Pass query and search parameters
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hybrid Search   â”‚
â”‚    Service       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ 4a. Semantic Search                 â”‚ 4b. Keyword Search
       â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VectorDB API    â”‚              â”‚  Elasticsearch   â”‚
â”‚  (Port 8001)     â”‚              â”‚   (Optional)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5a. Query ChromaDB               â”‚ 5b. Query ES index
       â”‚     with embeddings              â”‚     with keywords
       â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vector Results  â”‚              â”‚ Keyword Results  â”‚
â”‚  [id, score]     â”‚              â”‚  [id, score]     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ 6. Combine Results
                     â”‚    â€¢ Normalize scores (0-1)
                     â”‚    â€¢ Apply weights (70/30)
                     â”‚    â€¢ Merge & deduplicate
                     â”‚    â€¢ Sort by combined score
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Merged Results  â”‚
              â”‚  [id, combined]  â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ 7. Return JSON response
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   API Server     â”‚
              â”‚   (Port 3000)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ 8. Format response
                     â”‚    Add metadata
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Streamlit UI    â”‚
              â”‚  (Port 8501)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ 9. Render results
                     â”‚    Display email cards
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      User        â”‚
              â”‚  Sees Results    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                           DEPLOYMENT ARCHITECTURE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Windows PowerShell Terminals                           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Terminal 1    â”‚  â”‚   Terminal 2    â”‚  â”‚   Terminal 3    â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚  python         â”‚  â”‚  python         â”‚  â”‚  python -m      â”‚            â”‚
â”‚  â”‚  vectordb_      â”‚  â”‚  api_server.py  â”‚  â”‚  streamlit run  â”‚            â”‚
â”‚  â”‚  service.py     â”‚  â”‚                 â”‚  â”‚  streamlit_     â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚  Port: 3000     â”‚  â”‚  app.py         â”‚            â”‚
â”‚  â”‚  Port: 8001     â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚  Status: âœ…     â”‚  â”‚  Port: 8501     â”‚            â”‚
â”‚  â”‚  Status: âœ…     â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚  Status: âœ…     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  OR: Run startup script in one terminal:                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PS C:\> .\start-all-services.ps1                                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  âœ… Starting VectorDB Service (Port 8001)...                        â”‚   â”‚
â”‚  â”‚  âœ… Starting API Server (Port 3000)...                              â”‚   â”‚
â”‚  â”‚  âœ… Starting Streamlit UI (Port 8501)...                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  All services started in separate windows!                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                              PORT ALLOCATION

  Port 8001  â†’  VectorDB Service (FastAPI)
                â€¢ Semantic search engine
                â€¢ ChromaDB backend
                â€¢ Embedding generation
                â€¢ Health monitoring

  Port 3000  â†’  API Server (FastAPI)
                â€¢ Main REST API
                â€¢ Search orchestration
                â€¢ Email management
                â€¢ Swagger documentation

  Port 8501  â†’  Streamlit UI
                â€¢ Web interface
                â€¢ User interaction
                â€¢ Result visualization
                â€¢ Category filtering

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                            TECHNOLOGY STACK

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend:        Streamlit 1.28+                                            â”‚
â”‚                   â€¢ Python-based web framework                               â”‚
â”‚                   â€¢ Reactive UI components                                   â”‚
â”‚                   â€¢ Real-time updates                                        â”‚
â”‚                                                                              â”‚
â”‚  Backend:         FastAPI 0.104+                                             â”‚
â”‚                   â€¢ Async request handling                                   â”‚
â”‚                   â€¢ Auto-generated docs                                      â”‚
â”‚                   â€¢ Pydantic validation                                      â”‚
â”‚                                                                              â”‚
â”‚  Search:          ChromaDB + Elasticsearch                                   â”‚
â”‚                   â€¢ Vector similarity search                                 â”‚
â”‚                   â€¢ Full-text indexing                                       â”‚
â”‚                   â€¢ Hybrid result merging                                    â”‚
â”‚                                                                              â”‚
â”‚  ML/AI:           PyTorch 2.6.0+cpu                                          â”‚
â”‚                   SentenceTransformers                                       â”‚
â”‚                   â€¢ CPU-optimized inference                                  â”‚
â”‚                   â€¢ 384-dim embeddings                                       â”‚
â”‚                   â€¢ No GPU required                                          â”‚
â”‚                                                                              â”‚
â”‚  Language:        Python 3.8+                                                â”‚
â”‚                   TypeScript 4.9+ (for email sync)                           â”‚
â”‚                                                                              â”‚
â”‚  Platform:        Windows, macOS, Linux                                      â”‚
â”‚                   â€¢ Cross-platform compatible                                â”‚
â”‚                   â€¢ No special hardware requirements                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Key Architectural Decisions

### 1. **3-Tier Architecture**
- **Presentation:** Streamlit UI (user-facing)
- **Application:** FastAPI server (business logic)
- **Data:** VectorDB + Elasticsearch (storage & search)

**Why?** Separation of concerns, scalability, maintainability

### 2. **CPU-Only Optimization**
- PyTorch CPU build, no CUDA
- Environment variables force CPU mode
- Explicit device selection

**Why?** Wider accessibility, lower costs, no GPU required

### 3. **Hybrid Search**
- 70% semantic + 30% keyword weighting
- Score normalization before merging
- Fallback to VectorDB-only

**Why?** Best of both worlds, improved relevance

### 4. **Microservices Pattern**
- Each service runs independently
- Clear API boundaries
- Can scale services separately

**Why?** Flexibility, fault isolation, easier debugging

### 5. **FastAPI for All APIs**
- Async/await support
- Auto-generated OpenAPI docs
- Pydantic validation

**Why?** Modern, fast, well-documented, type-safe
